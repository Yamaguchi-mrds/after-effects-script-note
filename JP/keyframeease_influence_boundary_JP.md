# 📚 KeyframeEaseの0.1 問題とその回避策

### 公式仕様

- After Effects Scripting Guide では **KeyframeEase の influence 引数は 0.1〜100 の範囲**と定義されている。
    
- ただし、この「境界値 0.1」が常に受け入れられるとは限らない。
    

### 実際の挙動で報告されていること

- スクリプト経由で `KeyframeEase(..., 0.1)` を呼び出した際に、
    
    - **通る場合**と
        
    - **「parameter 2 out of range 0.1 to 100」としてエラーになる場合**がある。
        
- 表示上は同じ「0.1」であっても、内部処理や環境によって結果が変わる。
    

### よくある要因

- **浮動小数点誤差**
    
    - 計算の経路によって「0.1」が実際には `0.099999…` となり、範囲外判定されることがある。
        
- **AE内部状態の違い**
    
    - 同じ値でも「どこから来た値か」（計算結果か、定数か、UI操作の結果か）によって扱われ方が異なり、エラーになったりならなかったりする。
        
- **APIの判定の厳密さ**
    
    - UIでは受け入れられる値が、スクリプトAPI経由だと厳密にチェックされて弾かれるケースがある。
        

### 外部情報との整合

- Adobe公式フォーラムやユーザー報告でも、
    
    - **「UIでは小さい値が入力できるのに、スクリプトから同じ値を渡すとエラーになる」**  
        といった事例が複数見られる。
        
- これは AE API が内部で持つ浮動小数点処理や境界チェックが、必ずしも UI と一致しないことを示している。
    

### 実務的な指針

- **境界値（0.1ちょうど、100ちょうど）には依存しない**。
    
- スクリプトで扱う場合は、
    
    - 下限は **0.10001 以上**
        
    - 上限は **100 以下**  
        に丸めてから AE に渡すことで、エラーを防ぐのが安全策。
        

### 対策関数例
```jsx
// Influence値の範囲をAE仕様(0.1〜100)に収める補正用関数
// 特に境界0.1は不安定なため0.10000001に丸め上げて安全化する
function safeInfluence(x) {
    if (x < 0.10001) return 0.10000001; // 下限
    if (x > 100) return 100;         // 上限
    return x;
}
```
---


# ✅ まとめ

- **0.1は仕様上は許容値だが、AEの内部状態次第でエラーになることがある。**
    
- **safeInfluence() による丸め上げ（0.10001以上保証）で安定化**。
    
- 今後も AE API の「境界値」「内部丸め」には注意が必要。
    

